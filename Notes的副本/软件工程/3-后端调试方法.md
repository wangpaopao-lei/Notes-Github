# 后端调试方法

如果想要调试某个功能，以 “register” 注册用户为例

## 准备工作

### 数据库部分

1. 安装 mysql（或其他关系数据库），可以选择在 docker 上安装
   - `docker pull mysql`
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426010158135.png" alt="image-20230426010158135" style="zoom:50%;" />
   - 设置好映射端口号、挂载目录、环境变量后启动容器
2. 在终端中启动 mysql 服务器，新建一个数据库
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426010354651.png" alt="image-20230426010354651" style="zoom:50%;" />
3. 这时可以使用 mysql 客户端进行可视化，此处使用 Navicat
   - ![image-20230426010506457](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426010506457.png)
   - 填写好 host 和 port （刚才创建容器时映射的端口号）即可成功连接

### 后端程序部分

1. 新建一个 conda 环境，安装所有程序需要的依赖，可以选择用 txt 文件安装
   - `pip install -r requirement.txt`
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426010857364.png" alt="image-20230426010857364" style="zoom:50%;" />
2. 安装 pymysql 库
   - `pip install pymysql`
3. 修改 config.json 文件，填写要连接的数据库的 host:port 和用户
   - ![image-20230426010715650](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426010715650.png)
4. 修改 orm.py 文件，在程序最下方，修改两处
   - ![image-20230426011109681](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426011109681.png)
   - 主函数用来运行这个建表的命令
5. 运行 orm.py ，去 mysql 中检查，表已经创建成功
   - ![image-20230426011233351](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426011233351.png)
6. ==把 orm.py 恢复原样==
7. 运行 main.py 文件，出现如下消息即为启动服务器成功，==注意进程运行的地址为 localhost:8000==
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426011336959.png" alt="image-20230426011336959" style="zoom:50%;" />

### 其他准备工作

1. 安装 postman，加入我的工作组
2. 新建一个request
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426011744458.png" alt="image-20230426011744458" style="zoom:50%;" />
3. 安装 Eolink，加入我的项目



## 测试步骤

1. 在 port.py 中找到需要测试的功能部分，找到该报文发送的 url
   - ![image-20230426011910703](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426011910703.png)
   - 此处 url 为/api/user/register，则在 postman 中的 url 处填写<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426012008679.png" alt="image-20230426012008679" style="zoom:50%;" />
2. 选择报文的种类，一般为 post 和 get
3. 依据 json_schema.py 和 api-doc.yml 中对报文格式的定义，编写报文的数据部分“body”
   - 报文格式
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426012152527.png" alt="image-20230426012152527" style="zoom:50%;" />
   - 编写 body
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426012225575.png" alt="image-20230426012225575" style="zoom:50%;" />
4. 点击 send，查看结果

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426012250237.png" alt="image-20230426012250237" style="zoom:50%;" />

5. 到 mysql 中查看是否完成相应的功能
   - <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426012325114.png" alt="image-20230426012325114" style="zoom:50%;" />
6. 测试完成
7. 将测试完的 api 编写到 Eolink 中
   - ![image-20230426013050490](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230426013050490.png)



## 注意事项

1. 此处仅给了一个测试成功的例子，在实际过程中各种情况都要测试到
2. postman 中的各个 request 建议保存，方便之后调试
3. Eolink 的编写非常重要，==非常重要！！这是前后端对接的依据==，实际上，在这个程序中，就是完成了 api-doc.yml 这个文件的工作，记录在软件里可读性更强，更方便同步和维护。
4. 源程序中的 api-doc.yml 并未参与到后端的配置中，仅作为开发人员的约定