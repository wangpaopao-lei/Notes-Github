![image-20220525230313942](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220525230313942.png)

# ①  Introduction

[toc]

## 1 基本概念

---

==网络层处理的信息单位是 packet（分组）==

两种服务：可靠的面向连接服务，无连接服务

end-to-end(host-to-host) 端到端服务（主机到主机）（链路层为点到点）

![image-20220525230911124](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220525230911124.png)

若干点到点组成

## 2 网络层的任务

---

### 2.1 Internetworking网络互联

连接不同网络（LAN or WAN）

不同网络地址不同，实现技术不同，帧格式不同

### 2.2 Addressing编址

在传输层，对于不同网络所有端口/路由器的地址应该相同

==数值唯一、格式一致==（如IP）

### 2.3 Packetizing组包

按照网络层格式组成包

### 2.4 Fragmenting分片

1. 路由器连接异构的网络
2. 不同的数据链路层网络支持的最大数据长度不同

### 2.**5 Routing路由**

![image-20220526084228647](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220526084228647.png)

## 3 网络层提供的服务

---

### 3.1 设计目标

1. 服务与路由技术无关，只是为上层提供服务
2. 为传输层屏蔽底层网络细节
3. 网络范围内网络地址唯一

### 3.2 服务类别

1. ==面向连接的==——virtual Circuit 虚电路
2. ==无连接的==——datagram 数据报

分组交换

![image-20220526085305960](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220526085305960.png)

![image-20220526103955082](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220526103955082.png)

# ② Routing

## 1 基本概念

---

### 1.1 路由表=路由算法+路由协议

路由算法：构造、更新路由表

- 选择输入包要走的输出线路
- 如果是数据报，每一个包都要选路
- 如果是虚电路，只在建立虚电路时选路

路由协议：在每个线路发生改变时对路由器的一系列流程（如 RIP，OSPF，BGP）

### 1.2 评价标准

- 正确
- 简单
- 鲁棒
- 稳定：算法可快速收敛达到稳定平衡状态
- 公平
- 优化

### 1.3 路由算法分类

- Static Routing(Nonadaptive)
  - 事先规划好，下载到路由器
- Adaptive
  - 适应网络拓扑和业务量的变化

### 1.4 宿树

以目的节点为根，所有源节点到目的节点的最优路

### 1.5 最优化原则

最优路径上的任意两点之间的路径也是最优的

## 2 DJ最短路算法

---

原点作为根放入永久节点集合，找到距离原点为一跳的所有节点，其中距离原点最近的点放入永久节点集合

## 3 主要路由策略

---

1. Fixed Routing固定查表路由
2. flooding泛洪（交换机对未知路径就是 flooding），转发到所有路径
3. 随机选路，主要用于不需要指定线路的网络中（对拓扑不敏感）
4. ==Adaptive Routing自适应选路==

### 3.1 Flooding泛洪

- 无需路由表
- 所有端口连续转发到所有相邻端口

**Problem**

会产生海量数据包，尤其是在大规模网络中

**solution**

- 限定跳数
- 通过序号判断是否被转发过
  - 只记录包的最大序号

**Properties**

1. 所有路径都试过→健壮
2. 至少一个包走的是最短路径
3. 所有节点都被访问过→可用于分发路由信息

### 3.2 DVR距离矢量选路

Distance Vector Routing

基于==贝尔曼福德算法==

- 每个路由器维护一个路由表
- 表头为：目的节点 距离 路径(direction)
- 矢量( distamce, direction)
- 每个周期拿到邻居的路由表，根据邻居的路由表生成自己的路由表

**具体协议**：RIP

**Features**

1. 广播==整个路由表==
2. 只跟邻居交换信息
3. 通过所有接口发送信息
4. ==周期性==交互

**Issues**

- 收敛速度可能比较慢
- 好消息反应迅速，坏消息反应慢