![image-20220611193116462](/Users/wangpaopaopao/Library/Application%20Support/typora-user-images/image-20220611193116462.png)

# 目录

[toc]

# 一、Introduction

## 位置

---

![image-20220611193441302](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220611193441302.png)

端节点为五层

路由器是下三层

交换机和 hub 是下两层

传输层为用户功能的底层

## 功能

---

提供高效、稳定、==Process-to-process==的传输服务

### 两类服务

1. 面向连接的服务 TCP
2. 无连接的服务 UDP

### Problem1

传输层服务和网络层服务很类似，如服务类型、连接的管理、寻址、流量控制等，为什么还要分成两层？

1. 用户对网络层没有真正的控制权，但是可以控制传输层
2. 当需要增加某些通信处理功能时，修改传输层更容易（对网络层的修改要对全网所有路由器进行 update）
3. 向用户隐藏网络细节

# 二、传输层协议

![image-20220611194737853](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220611194737853.png)

## 数据链路层 vs 传输层

---

相似：都具有差控、顺序、流控，点到点传输、端到端传输

主要差别：==环境差别==

1. 数据链路层工作在物理层上，直接面向物理信道
2. 传输层工作在网络层之上，信道通过网络连接
3. 编址、建立连接、存储的实现难度不同

## 编址

---

端口号

16bit

### 三类端口

![image-20220611214336109](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220611214336109.png)

1. well-known
   - 知名的应用层协议的端口，如 ftp，web，http
2. Registered
   - 要到 IANA 走流程申请
3. Private and dynamic
   - 临时端口，用完失效



IP 地址+端口号=socket number

定位主机+定位进程=唯一识别进程

因此 port 为本机唯一而非全局唯一

## 连接管理（建立、释放）

---

目标：建立且仅建立一个连接

### 两次握手

1. 发送方发送 Connection Request（CR）
2. 接收方发送 ACK
3. 连接建立

Problem：多重连接

![image-20220611215911495](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220611215911495.png)

重传的 CR 被当做新的 CR

Solution：

### 三次握手

1. 发送方发送 CR
2. 接收方发送 ACK
3. 发送方发送 ACK 的 ACK
4. 连接建立
   - 如果接收方发现 CR 重复，连续发送 ACK
   - 发送方收到不相符的 ACK，发送 REJECT
   - 接收方收到 REJECT，释放资源

### 连接释放

目标：释放过程不丢包、无半开放连接（另一半未释放资源）

#### Violent 突然

双方约定某个时间都不发数据

Problem：

1. 信道不稳定情况下，不知道自己的 ACK 是否被对方收到
2. 对等协议永远不可能同时释放

#### Graceful 平滑

1. 将双工信道看做两个独立的单工信道
2. 自己停止发送的时候，发送请求，收到 ACK 即单方面停止发送数据
3. 另一个方向同样