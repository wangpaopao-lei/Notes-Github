

![image-20220420095505166](https://raw.githubusercontent.com/wangpaopao-lei/pic/master/image-20220420095505166.png)

# CPU

## CPU 的功能

---

### 1 指令控制

1. 控制程序的是执行顺序
2. 取出现行指令，并决定下条要执行的指令地址
3. CPU 内与指令控制相关的部件
   1. 程序计数器 PC（指令计数器）
      * 确定下一条指令的地址
      * 程序开始执行前，将程序的第一条指令所在地内存单元地址送入 PC
      * 顺序执行指令时，CPU 将自动修改 PC 内容，
   2. （内存）地址寄存器 MAR/AR
      * 保存当前 CPU 所访问的内存单元或 IO 接口的地址
      * 稳定保存访存地址，弥补内存和 CPU 之间速度的差别
   3. （内存）数据寄存器MDR/DR，缓冲寄存器
      * 输入缓冲：暂存内存单元或 IO 接口读出的指令或数据
      * 输出缓冲：暂存向内存单元或 IO 接口存入的数据
      * ==作用==：用作信息中转站，补偿 CPU 和内存、外设接口之间的速度差别；作为内存操作数的缓冲参加 CPU 的运算

### 2 操作控制

1. 指令取出后，CPU 依照操作码字段和形式地址段解释指令，指出是何操作、如何得到操作数地址
2. CPU产生每条指令的操作信号，把各种操作信号 送往相应的部件，从而控制这些部件按指令的要 求进行动作
3. CPU 内与操作控制相关的部件
   1. 指令寄存器 IR
      * 保存当前正在执行的一条指令
      * 保存指令时，指令先取到缓冲寄存器中，再传送到指令寄存器
      * 指令寄存器中操作码字段就是指令译码器的输入
   2. 指令译码器 ID
   3. 操作控制器‘

#### 硬布线控制器（组合逻辑）

用组合逻辑电路产生固定时序控制信号

控制信号形成部件是由门电路组成的复杂树形网络

#### 微程序控制器（存储逻辑）

硬件软化

指令执行速度比硬布线慢

### 3 时序控制

### 4 数据加工

1. 通过算术运算或逻辑运算将原始信息转换成所需的结果
2. CPU 内与数据加工相关的部件
   1. ALU
   2. 浮点运算器
   3. 通用寄存器组
      * 早期：单累加器结构
        * 累加器：与 ALU 有直捷通路的通用寄存器
        * 功能：执行算术或逻辑运算时，为 ALU 提供一个工作区
      * 当前：通用寄存器堆结构
        * 有十几个甚至几十上百个通用寄存器有累加器功能
        * 其中任何一个寄存器均可存放源操作数和结果操作数
   4. 状态条件寄存器（程序状态字寄存器）
      * ==功能==：保存有算术指令和逻辑指令运算或测试的结果建立的各种条件码
        * 进位标志C
        * 溢出标志V
        * 零标志Z
        * 负标志N
      * 保存中断和系统工作状态等信息
      * 控制位

## CPU的基本组成

---

运算器

控制器



指令周期

- CPU 从内存中取出指令并执行指令的时间
- 连续两次取指的间隔时间
- 取指时间+执行时间

时钟周期

- 节拍脉冲、节拍周期、T 周期
- 操作的最基本时间单位
- 一个指令周期由多个时钟周期构成

机器周期（CPU 周期）

- CPU 与内存交换一次信息的时间
- 在现代计算机系统中逐渐消失（机器周期=时钟周期）



指令执行过程

1. 取指阶段fetch（==见 P206==）
   1. 从内存取指送至 IR
   2. 修改 PC
   3. 对指令操作码进行译码
   4. <img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220530112716762.png" alt="image-20220530112716762" style="zoom:50%;" />
2. 取操作数阶段
   - 由形式地址计算实际地址并访存取得操作数
   - 只有在需要到内存取操作数的指令才有该阶段
   - 因指令而各不相同
3. 执行阶段



指令流程图

![image-20220530115358050](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220530115358050.png)



数据通路

CPU 内部信息传送通过 CPU 内部总线进行，CPU 与外界交换信息通过系统总线进行



时序

时序信号的作用：操作控制器利用定时脉冲的顺序和不同的脉冲间隔，有条理有节奏的指挥机器工作



控制器的控制方式：

- 控制序列的时序信号的形成方式
- 时序信号的定时方式

常用的控制方式

- 同步：时钟
- 异步：应答
  - 每条指令、每个微操作需要多少时间就占用多少时间
  - 采用握手方式建立时序关系
  - 场景：异步总线操作、各挂接部件速度差异大
- 联合控制：时钟+应答
  - 情况 1：固定+应答
    - 大部分操作安排在固定机器周期，某些难以确定的指令异步控制
  - 情况 2：半同步
    - 每个机器周期的节拍脉冲数固定，各个指令周期的机器周期数不固定由应答信号决定



多级时序体系

最基本的体制：电位-脉冲制

单周期、多周期和流水线处理器

单周期 CPU：在一个时钟周期内完成从取指到得到结果的所有工作

- 所有指令执行时间以最长的时间为止

多周期 CPU：把指令执行分成多个阶段，每个阶段对应一个时钟周期

流水线处理器：在多周期的基础上，让各个阶段的执行在时间上重叠并行执行



时序信号发生器：用逻辑电路产生各级定时信号

组成：

- 时钟源
- 脉冲发生器
- 节拍脉冲和读写时序译码逻辑
- 启停控制逻辑



微程序控制器与微程序设计技术

程序设计技术+存储逻辑

一条机器指令对应一个微指令序列构成的一段为微程序

取出微指令并据此产生微命令，进而实现机器指令要求的信息传送和加工

![image-20220530152245710](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20220530152245710.png)