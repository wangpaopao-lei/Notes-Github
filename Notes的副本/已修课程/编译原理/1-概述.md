## Content

[toc]

# 编译概述

![image-20230228133430031](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230228133430031.png)

## 翻译与解释

### 高级语言的优点

1. 独立于机器，程序移植性比较好
2. 不需要了解机器内部的形式
3. 丰富的数据结构与控制结构
4. 更接近自然语言
5. 编程效率高

### 翻译程序

![image-20230301075921126](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230301075921126.png)

#### 编译程序

源程序→目标程序

1. 汇编程序：汇编语言程序→机器语言程序
2. 编译程序：高级语言程序→低级语言程序

![image-20230301080050346](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230301080050346.png)

源程序和数据分别在不同时间进行处理

#### 解释程序

![image-20230301080200109](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230301080200109.png)

- 同时处理源程序和数据
- 解释执行源程序，不生成目标程序

## 阶段和任务

1. 分析阶段
   1. 词法分析
   2. 语法分析
   3. 语义分析
2. 综合阶段
   1. 中间代码生成
   2. 代码优化
   3. 目标代码生成
3. 符号表管理
4. 错误的诊断和处理

![image-20230301080457487](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230301080457487.png)

### 分析阶段

根据源语言得到定义，进行结构分析呃语义分析，把源程序正文转换为某种内部表示

#### 词法分析

1. 扫描，对构成源程序的字符串进行分解，
2. 识别出每个具有独立意义得到单词==lexeme==，将其转化为==token==
3. 把需要存放的单词放到符号表中，如变量名、标号、常量名

**工作依据**：构词法（pattern），比如 C 语言标识符的模式

#### 语法分析

把 token 流按语言的语法结构层次地分组形成语法短语

常用分析树表示

![image-20230301095504365](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230301095504365.png)

**工作依据**：语法规则

![image-20230301095023475](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230301095023475.png)

5. 如果 a[i]中的 i 是外部定义的变量发生越界，则在语义分析时可以发现，如果是在一个 for 循环里的 i，可能只有在运行时才能被发现

6. 可能是语法分析、可能是词法分析

#### 语义分析

对语法成分的意义进行检查分析

语法成分：语法分析确定 层次结构

收集必要信息：类型、作用域

**工作依据**：语义规则

**重要任务**：类型检查

- 检查每个运算符及其运算对象是否符合要求
- 数组下标是否合法
- 过程调用时，形参与实参个数、类型是否匹配

![image-20230303192841775](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230303192841775.png)

### 综合阶段

得到与源程序等价的目标程序

#### 中间代码生成

- 抽象的机器程序

- **两个特点**：

  1. 易于产生

  2. 易于翻译成目标代码

- 有多种形式
- ==三地址码==
  1. 每条指令除了赋值号之外，最多含有一个运算符
  2. 编译程序必须生成临时变量名以保存每条指令的计算结果
  3. 有些三地址指令少于三个操作数

![image-20230303192912245](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230303192912245.png)

#### 代码优化

**在中间代码上进行优化**

![image-20230303193006472](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230303193006472.png)

#### 目标代码生成

- 目标代码
  - 可重定位的机器代码
  - 汇编语言代码
- ==两个重要问题==
  - 对每个变量指定存储单元
  - 对变量进行寄存器分配

![image-20230303193155770](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230303193155770.png)

### 符号表管理

### 错误处理

编译的每个阶段都有可能检测到源程序中存在的错误

1. 词法分析：非法字符错误
2. 语法分析：记号流不合语法规则的错误
3. 语义分析：检测出具有正确的语法结构，但对所涉及的操作无意义的结构
4. 代码生成：目标程序区超出了允许范围的错误

## 前端和后端

划分前后端的有点

1. 便于编译程序移植
2. 、、构造

## “遍”

对源程序或其中间形式从头到尾扫描一遍

### 一遍扫描编译程序

![image-20230303193844274](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230303193844274.png)

==以语法分析为核心==

### 多遍编译

![image-20230303193945510](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230303193945510.png)

## 伙伴工具

### 预处理器

1. 宏处理
2. 文件包含（头文件）
3. 语言扩充

### 汇编程序

### 链接装配程序

