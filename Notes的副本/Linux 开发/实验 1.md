# Linux开发环境及应用第一次上机作业（正则表达式）







> 姓名：王磊
>
> 学号：2020211538
>
> 班级：2020211321









## 实验要求

---

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221010000956322.png" alt="image-20221010000956322" style="zoom:50%;" />

<div STYLE="page-break-after: always;">

## 实验过程

---

### 下载数据

使用  `wget  `  指令将网页内容保存至服务器。

```shell
wget http://www.86pm25.com/city/beijing.html
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009200615427.png" alt="image-20221009200615427" style="zoom: 50%;" />

<div STYLE="page-break-after: always;">

### 检查数据

使用 `cat` 指令检查 html 文件，寻找需要的信息。

```shell
cat beijing.html | more
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009200638864.png" alt="image-20221009200638864" style="zoom: 50%;" />

<div STYLE="page-break-after: always;">

### 提取数据

在上一步中，我们发现，时间信息是跟随在 “更新时间” 之后的，各监测站点浓度信息则是在 “\<td\>\<tr\>” 标签之后，因此使用 `grep` 命令提取出包含这两个关键字的行。

```shell
cat beijing.html | grep -e '更新' -e '<tr><td>'| more
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009201820224.png" alt="image-20221009201820224" style="zoom:50%;" />

<div STYLE="page-break-after: always;">

### 数据处理

在这一步由于需要用到的 `sed` 命令过多，为了便于观察和修改，采用编写 cmd 文件的方式。此处编写了1.cmd 文件用于后续 `sed` 命令。

```shell
vim 1.cmd
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221010002042325.png" alt="image-20221010002042325" style="zoom: 33%;" />

***逐行解释含义：***

1. `s/<[^<>]*>/ /g`：删除数据中的标签，这里采用一组<>里带一组 [ ] 集合的星闭包的形式，为了应对可能出现的逻辑上的嵌套，[ ] 中的 ^ 号指明了尖括号出现在字符串首，解释了尖括号内可能出现的内容。
2. `s/更新：/时间 /g`：将数据中的“更新：”改为“时间”，没有直接删除的原因是要在后续处理中充当查找时间信息的关键字。
3. `s/\([0-9][0-9]*\)年\([0-9][0-9]\)月\([0-9][0-9]\)日 *\([0-9][0-9]\)时/\1-\2-\3 \4:00:00/g` ：使用流编辑中的圆括号对信息进行替换，改成我们需要的格式。
4. `s/μg\/m³/ /`：数据中有两列包含了“μg/m³”单位的数据，第一列为 PM10 数据，第二列为 PM2.。删除 PM10 的单位，在进行替换时不使用控制字符 `g`，表示只对读到的第一个单位进行处理；保留 PM2.5 的单位，在后续处理中充当关键字。
5. `s/^ *//g`：删除所有行首空格以保证格式正确。

***执行以下命令：***

```shell
 cat beijing.html | grep -e '更新' -e '<tr><td>'| sed -f 1.cmd| more
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009232657184.png" alt="image-20221009232657184" style="zoom:50%;" />

### awk 文件处理和输出

同样地，为了便于管理，采用编写 awk 文件的方式执行后续 `awk` 命令。

```shell
vim 2.awk
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009235620308.png" alt="image-20221009235620308" style="zoom: 33%;" />

***逐行解释含义：***

1. `/时间/ { date=$2; time=$3;}`：读到以“时间”开头的数据行时，分别将时间和日期保存至变量 `date`，`time` 中。
2. `/μg\/m³/ {printf("%s %s,%s,%s\n",date,time,$1,$4);}`：读到“μg/m³”单位时，格式化地输出所有信息。

***执行以下命令：***

使用 `>ans.csv` 将输出结果重定向至 csv 文件中，使用 ls 命令以查看文件。

```shell
cat beijing.html | grep -e '更新' -e '<tr><td>' |sed -f 1.cmd |awk -f 2.awk| sed -e 's/μg\/m³//g'>ans.csv
ls
```

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009234113901.png" alt="image-20221009234113901" style="zoom:50%;" />

### 文件传输

使用 sftp 工具 transmit5 将生成的 csv 文件传输至本地。

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221009235742463.png" alt="image-20221009235742463" style="zoom:50%;" />

<div STYLE="page-break-after: always;">

### 查看结果

在本地打开 csv 文件，实验完成。

<img src="https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20221010124302872.png" alt="image-20221010124302872" style="zoom: 50%;" />