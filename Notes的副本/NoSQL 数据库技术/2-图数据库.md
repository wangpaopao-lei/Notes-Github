##  contents

[toc]

# 图数据库

![image-20230302115644970](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230302115644970.png)

## 概述

以实体及其关系作为主要存储对象的数据库系统

**核心数据要素**

- 节点 vertex
- 边 edge
- 属性 attribute
- 标签 label：节点、关系的类别

**按底层存储技术分为两类**

- 原生图存储类

  - 非关系模型
  - 免索引邻接的方式存储
  - Neo4j、Tigergraph

- 非原生图存储

  - 采用键值数据率、文档数据库、列簇数据库等
  - 需要建立全局索引来提高数据的访问性能

  

## ※ 图关键数据存储逻辑架构

节点之间的关系通常包含一个起始节点、一个终止节点、一种关系类型、0 个或多个属性

neo4j 里，属性由键值对组成，键名称为字符串类型数据

属性模式是自由的，不用节点可以定义自己特有的描述属性

label 是类别的概念，不同的节点与关系可以具有相同的节点标签与关系类型标签

一个节点可以有零个或多个标签，而一个关系必须有且只有一个关系类型，

路径（逻辑概念）：每条路径由一个起始节点，一个终止节点、从起始节点到终止节点经过的一条或多条边及关联节点构成。

路径长度（类似图论中的定义）

关系是最重要的元素，每个节点都会维护与他相邻节点的作用，因此每个节点都相当于它相邻节点的微索引，查询时间受图整体规模影响小，只与它附近节点的数量成正比，这比全局索引的代价小很多。



## ※属性图模型

类比关系模型，是图数据的数据模型

- 数据结构：节点、边、属性、标签
- 数据操作：图代数（可达性查询、最短路径查询、图节点边关系的增删改查排序
- 完整性约束：条件约束（唯一性约束），比如标签为 person 的电话号码属性不能重复等



关系数据库中

- 一行数据：图的一个节点
- 表名称：节点的一个 label（节点的一种类别）

节点：圆形，对应实体，一般是名词词汇

关系：有向边，一般是动词词汇

![image-20230308231010198](https://wangleidetuchuang.oss-cn-beijing.aliyuncs.com/img/image-20230308231010198.png)

## ※图数据库查询语言

Cypher：声明式模式匹配语言，简称 CQL

==匹配模式==：开始节点、关系、结束节点的组合。匹配模式可以定义为一个变量

### 查询语句

```cypher
MATCH(n)
WHERE id(n)=1
RETURN n
```

### 变量定义

- 定义节点变量`(a)`
- 定义节点之间的关系`(a)-->(b)`
- 显式地表示关系并定义关系变量`(a)-[r]->(b)`

### 节点标识

每个节点都有一个整数 ID唯一表示，创建时自动分配

可以通过 id 函数返回节点标识

### 节点数据定义

- 如果括号为空，表示匿名节点
- 如果要在语句中引用该节点，需要定义节点变量，如（a）
- 可以指定节点符合标签`(:person:master)`
- 可以指定节点属性内容`(:person{name:"Wang",age:26})`
- 可以同时指定变量、标签、属性`(a:person{name:"Wang",age:26})`

### 关系定义

- 用`-->`或`<--`表示有向关系，`--`表示无向关系

- 可以详细限定关系满足的条件

- ```cypher
  (a)-[r:friend_of{year:2019,type:"football"}]->(b)
  ```

- 表示节点间在 2019 年建立的球友关系

### 路径匹配模式

- 长度为 1，忽略方向`(a)--(b)`
- 指定长度为 k 的路径`(a)-[*k]->(b)`
- 指定一个长度区间`(a)-[*k..n]->(b)`
- 指定任意长度`(a)-[*]->(b)`

## 图数据库应用

